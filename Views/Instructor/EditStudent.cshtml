@model StudentViewModel
@{
    ViewBag.Title = "Edit Student";
}

<h2 class="mb-4">Edit Student</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <strong>Success!</strong> @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>Error!</strong> @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<form asp-action="EditStudent" method="post" enctype="multipart/form-data">
    <div class="accordion" id="studentAccordion">

        <!-- SECTION 1: Personal Information -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingPersonal">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePersonal" aria-expanded="true">
                    Personal Information
                </button>
            </h2>
            <div id="collapsePersonal" class="accordion-collapse collapse show" data-bs-parent="#studentAccordion">
                <div class="accordion-body">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label asp-for="FirstName" class="form-label"></label>
                            <input asp-for="FirstName" class="form-control" required />
                            <span asp-validation-for="FirstName" class="text-danger"></span>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="MiddleName" class="form-label"></label>
                            <input asp-for="MiddleName" class="form-control" />
                        </div>
                        <div class="col-md-4">
                            <label asp-for="LastName" class="form-label"></label>
                            <input asp-for="LastName" class="form-control" required />
                            <span asp-validation-for="LastName" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label asp-for="Email" class="form-label"></label>
                            <input asp-for="Email" type="email" class="form-control" required />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="PhoneNumber" class="form-label"></label>
                            <input asp-for="PhoneNumber" class="form-control" required />
                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label asp-for="Gender" class="form-label"></label>
                            <select asp-for="Gender" class="form-select" required>
                                <option value="">-- Select Gender --</option>
                                <option>Male</option>
                                <option>Female</option>
                                <option>Other</option>
                            </select>
                            <span asp-validation-for="Gender" class="text-danger"></span>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="DateOfBirth" class="form-label"></label>
                            <input asp-for="DateOfBirth" type="date" class="form-control" required />
                            <span asp-validation-for="DateOfBirth" class="text-danger"></span>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="Address" class="form-label"></label>
                            <input asp-for="Address" class="form-control" required />
                            <span asp-validation-for="Address" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 2: Guardian Info -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingGuardian">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseGuardian">
                    Guardian Information
                </button>
            </h2>
            <div id="collapseGuardian" class="accordion-collapse collapse" data-bs-parent="#studentAccordion">
                <div class="accordion-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label asp-for="GuardianName" class="form-label"></label>
                            <input asp-for="GuardianName" class="form-control" required />
                            <span asp-validation-for="GuardianName" class="text-danger"></span>
                        </div>
                        <div class="col-md-6">
                            <label asp-for="GuardianPhone" class="form-label"></label>
                            <input asp-for="GuardianPhone" class="form-control" required />
                            <span asp-validation-for="GuardianPhone" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 3: Academic Info -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingAcademic">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAcademic">
                    Academic Information
                </button>
            </h2>
            <div id="collapseAcademic" class="accordion-collapse collapse" data-bs-parent="#studentAccordion">
                <div class="accordion-body">
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label asp-for="Grade" class="form-label"></label>
                            <input asp-for="Grade" class="form-control" required />
                            <span asp-validation-for="Grade" class="text-danger"></span>
                        </div>
                        <div class="col-md-4">
                            <label asp-for="EnrollmentDate" class="form-label"></label>
                            <input asp-for="EnrollmentDate" type="date" class="form-control" required />
                            <span asp-validation-for="EnrollmentDate" class="text-danger"></span>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 4: Login Info & Image -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingLogin">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseLogin">
                    Login Info & Profile Image
                </button>
            </h2>
            <div id="collapseLogin" class="accordion-collapse collapse" data-bs-parent="#studentAccordion">
                <div class="accordion-body">
                    <div class="row mb-3">
                        <div class="col-md-3">
                            <label asp-for="Username" class="form-label"></label>
                            <input asp-for="Username" class="form-control" required />
                            <span asp-validation-for="Username" class="text-danger"></span>
                        </div>
                        <div class="col-md-3 password-group">
                            <label asp-for="Password" class="form-label"></label>
                            <div class="input-group">
                                <input asp-for="Password" type="password" class="form-control" id="Password" />
                                <button type="button" class="btn btn-outline-secondary password-toggle" tabindex="-1" onclick="togglePassword('Password', this)">
                                    <i class="fa fa-eye-slash"></i>
                                </button>
                            </div>
                            <span asp-validation-for="Password" class="text-danger"></span>
                        </div>
                        <div class="col-md-3 password-group">
                            <label asp-for="ConfirmPassword" class="form-label"></label>
                            <div class="input-group">
                                <input asp-for="ConfirmPassword" type="password" class="form-control" id="ConfirmPassword" />
                                <button type="button" class="btn btn-outline-secondary password-toggle" tabindex="-1" onclick="togglePassword('ConfirmPassword', this)">
                                    <i class="fa fa-eye-slash"></i>
                                </button>
                            </div>
                            <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                        </div>
                        <div class="col-md-3">
                            <label asp-for="ProfileImage" class="form-label">Profile Image</label>
                            <input asp-for="ProfileImage" type="file" accept="image/*" class="form-control" />
                            <span asp-validation-for="ProfileImage" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="text-end mt-4">
        <button type="submit" class="btn btn-primary">Update Student</button>
    </div>
</form>

@section Scripts {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <script>
        function togglePassword(inputId, btn) {
            const input = document.getElementById(inputId);
            const icon = btn.querySelector('i');
            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
            } else {
                input.type = "password";
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
            }
        }
    </script>
    <style>
        .password-group .input-group {
            position: relative;
        }
        .password-toggle {
            border: none;
            background: transparent;
            color: #6c757d;
            font-size: 1.2rem;
            padding: 0 12px;
            cursor: pointer;
            transition: color 0.2s;
        }
        .password-toggle:focus {
            outline: none;
            box-shadow: none;
        }
        .password-toggle:hover {
            color: #007bff;
        }
        .input-group .form-control {
            border-right: 0;
        }
        .input-group .password-toggle {
            border-left: 0;
        }
    </style>
    @{ await Html.RenderPartialAsync("_ValidationScriptsPartial"); }
}